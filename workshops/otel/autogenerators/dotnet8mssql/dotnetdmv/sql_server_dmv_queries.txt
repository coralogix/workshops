SQL Server DMV Monitoring Queries

1. Server Information Query
SELECT 
    SERVERPROPERTY('ProductVersion') AS ServerVersion,
    SERVERPROPERTY('Edition') AS Edition,
    SERVERPROPERTY('ProductLevel') AS ServicePack,
    SERVERPROPERTY('IsClustered') AS IsClustered;

2. Database Information Query
SELECT 
    name AS DatabaseName,
    state_desc AS State,
    recovery_model_desc AS RecoveryModel,
    page_verify_option_desc AS PageVerify,
    is_auto_close_on AS AutoClose,
    is_auto_shrink_on AS AutoShrink
FROM sys.databases;

3. Memory Usage Query
SELECT 
    counter_name AS MetricName,
    cntr_value AS CurrentValue
FROM sys.dm_os_performance_counters
WHERE object_name LIKE '%Memory Manager%'
AND counter_name IN (
    'Total Server Memory (KB)',
    'Target Server Memory (KB)',
    'Connection Memory (KB)',
    'Lock Memory (KB)',
    'SQL Cache Memory (KB)',
    'Optimizer Memory (KB)'
);

4. CPU Usage by Database Query
SELECT 
    DB_NAME(database_id) AS DatabaseName,
    SUM(total_worker_time) AS CPUTimeMs,
    SUM(execution_count) AS ExecutionCount,
    SUM(total_worker_time)/SUM(execution_count) AS AvgCPUTimeMs
FROM sys.dm_exec_query_stats AS qs
CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID]
            FROM sys.dm_exec_plan_attributes(qs.plan_handle)
            WHERE attribute = N'dbid') AS epa
GROUP BY database_id
ORDER BY SUM(total_worker_time) DESC;

5. Wait Statistics Query
SELECT TOP 20
    wait_type,
    waiting_tasks_count,
    wait_time_ms,
    max_wait_time_ms,
    signal_wait_time_ms
FROM sys.dm_os_wait_stats
WHERE wait_type NOT LIKE '%SLEEP%'
ORDER BY wait_time_ms DESC;

6. IO Statistics Query
SELECT
    DB_NAME(database_id) AS DatabaseName,
    file_id,
    num_of_reads,
    num_of_writes,
    io_stall_read_ms,
    io_stall_write_ms,
    size_on_disk_bytes
FROM sys.dm_io_virtual_file_stats(NULL, NULL);

7. Connection Statistics Query
SELECT 
    DB_NAME(dbid) AS DatabaseName,
    COUNT(dbid) AS NumberOfConnections,
    login_time,
    host_name,
    program_name
FROM sys.sysprocesses
WHERE dbid > 0
GROUP BY dbid, login_time, host_name, program_name;

8. Transaction Information Query
SELECT 
    DB_NAME(database_id) AS DatabaseName,
    transaction_id,
    transaction_begin_time,
    transaction_type,
    transaction_state,
    transaction_status
FROM sys.dm_tran_active_transactions;

9. Index Usage Statistics Query
SELECT TOP 25
    OBJECT_NAME(s.object_id) AS TableName,
    i.name AS IndexName,
    s.user_seeks,
    s.user_scans,
    s.user_lookups,
    s.user_updates,
    s.last_user_seek,
    s.last_user_scan
FROM sys.dm_db_index_usage_stats s
INNER JOIN sys.indexes i ON i.object_id = s.object_id
    AND i.index_id = s.index_id
WHERE database_id = DB_ID()
ORDER BY (s.user_seeks + s.user_scans + s.user_lookups) DESC;

10. Query Execution Statistics Query
SELECT TOP 20
    qs.execution_count,
    qs.total_worker_time AS CPU_Time_Ms,
    qs.total_elapsed_time AS Total_Duration_Ms,
    qs.total_logical_reads AS Logical_Reads,
    qs.total_physical_reads AS Physical_Reads,
    SUBSTRING(qt.text, (qs.statement_start_offset/2)+1,
        ((CASE qs.statement_end_offset
            WHEN -1 THEN DATALENGTH(qt.text)
            ELSE qs.statement_end_offset
        END - qs.statement_start_offset)/2) + 1) AS QueryText
FROM sys.dm_exec_query_stats qs
CROSS APPLY sys.dm_exec_sql_text(qs.sql_handle) qt
ORDER BY qs.total_worker_time DESC;

Note: These queries should be executed with appropriate permissions. Some queries may need to be modified based on specific SQL Server version and configuration. Always ensure proper error handling and permission checks before execution. 